############################################
# STATIC ASSET SUBDOMAIN SECURITY HARDENING #
############################################

# --------------------------------------------------
# 1) Prevent directory listing
# --------------------------------------------------
Options -Indexes

# --------------------------------------------------
# 2) Force HTTPS (ONLY enable after SSL works)
# --------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</IfModule>

# --------------------------------------------------
# 3) HSTS (enable ONLY after HTTPS confirmed)
# --------------------------------------------------
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# --------------------------------------------------
# 4) Basic security headers
# --------------------------------------------------
<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "no-referrer-when-downgrade"
  Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# --------------------------------------------------
# 5) Disable ALL server-side script execution
# --------------------------------------------------
<FilesMatch "\.(php|php5|phtml|phps|cgi|pl|py|jsp|asp|aspx)$">
  Require all denied
</FilesMatch>

Options -ExecCGI
RemoveHandler .php .php5 .phtml .phps .cgi .pl .py .jsp .asp .aspx

# --------------------------------------------------
# 6) CORS â€“ allow only approved websites
# --------------------------------------------------
<IfModule mod_headers.c>
  #SetEnvIf Origin "https?://(www\.)?(webtechfocus\.com|marlenematos\.com)$" CORS_ALLOWED_ORIGIN=$0
  SetEnvIf Origin "https?://([a-z0-9-]+\.)?(marlenematos\.com)$" CORS_ALLOWED_ORIGIN=$0
  SetEnvIf Origin "https?://([a-z0-9-]+\.)?(webtechfocus\.com)$" CORS_ALLOWED_ORIGIN=$0
  Header always set Access-Control-Allow-Origin "%{CORS_ALLOWED_ORIGIN}e" env=CORS_ALLOWED_ORIGIN
  Header always set Access-Control-Allow-Methods "GET,HEAD,OPTIONS"
  Header always set Access-Control-Allow-Headers "Content-Type"
</IfModule>

# --------------------------------------------------
# 6a) Fonts MUST allow CORS (browser requirement)
# --------------------------------------------------
<FilesMatch "\.(ttf|otf|eot|woff|woff2)$">
  <IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
  </IfModule>
</FilesMatch>

# --------------------------------------------------
# 7) Aggressive caching for static assets
# --------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On

  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"

  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"

  ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>

# --------------------------------------------------
# 8) Hotlink protection (images only)
# --------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{HTTP_REFERER} !^$
  #RewriteCond %{HTTP_REFERER} !^https?://(www\.)?webtechfocus\.com/ [NC]
  #RewriteCond %{HTTP_REFERER} !^https?://(www\.)?marlenematos\.com/ [NC]
  RewriteCond %{HTTP_REFERER} !^https?://([a-z0-9-]+\.)?marlenematos\.com/ [NC]
  RewriteCond %{HTTP_REFERER} !^https?://([a-z0-9-]+\.)?webtechfocus\.com/ [NC]
  RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [F,NC,L]
</IfModule>

# --------------------------------------------------
# 9) Prevent MIME sniffing for assets
# --------------------------------------------------
<IfModule mod_headers.c>
  <FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|woff|woff2)$">
    Header always set X-Content-Type-Options "nosniff"
  </FilesMatch>
</IfModule>
